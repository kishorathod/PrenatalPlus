generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                   String                  @id @default(cuid())
  email                String                  @unique
  emailVerified        DateTime?
  name                 String?
  password             String
  role                 UserRole                @default(PATIENT)
  phone                String?
  dateOfBirth          DateTime?
  avatar               String?
  address              String?
  city                 String?
  state                String?
  zipCode              String?
  country              String?
  specialization       String?
  departmentId         String?
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @updatedAt
  isVerified           Boolean                 @default(false)
  hospitalClinic       String?
  medicalLicenseNumber String?
  yearsOfExperience    Int?
  accounts             Account[]
  aiChatSessions       AIChatSession[]
  doctorAppointments   Appointment[]           @relation("DoctorAppointments")
  appointments         Appointment[]
  contractionSessions  ContractionSession[]
  contractions         Contraction[]
  doctorConversations  Conversation[]          @relation("DoctorConversations")
  patientConversations Conversation[]          @relation("PatientConversations")
  doctorSchedules      DoctorSchedule[]        @relation("DoctorSchedules")
  kickCounts           KickCount[]
  doctorLabTests       LabTestRequest[]        @relation("DoctorLabTests")
  patientLabTests      LabTestRequest[]        @relation("PatientLabTests")
  doctorNotes          MedicalNote[]           @relation("DoctorNotes")
  patientNotes         MedicalNote[]           @relation("PatientNotes")
  reports              MedicalReport[]
  medicationReminders  MedicationReminder[]
  sentMessages         Message[]               @relation("SentMessages")
  preferences          NotificationPreference?
  notifications        Notification[]
  doctorAssignments    PatientAssignment[]     @relation("DoctorAssignments")
  patientAssignments   PatientAssignment[]     @relation("PatientAssignments")
  pregnancies          Pregnancy[]
  doctorPrescriptions  Prescription[]          @relation("DoctorPrescriptions")
  patientPrescriptions Prescription[]          @relation("PatientPrescriptions")
  sessions             Session[]
  adminLogs            SystemLog[]
  department           Department?             @relation(fields: [departmentId], references: [id])
  vitalReadings        VitalReading[]
  vitals               VitalSign[]

  @@map("users")
}

model Pregnancy {
  id                  String               @id @default(cuid())
  userId              String
  startDate           DateTime
  dueDate             DateTime
  currentWeek         Int                  @default(0)
  status              PregnancyStatus      @default(ACTIVE)
  riskLevel           RiskLevel?           @default(LOW)
  bloodType           String?
  rhFactor            String?
  height              Float?
  prePregnancyWeight  Float?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  appointments        Appointment[]
  contractionSessions ContractionSession[]
  contractions        Contraction[]
  kickCounts          KickCount[]
  labTestRequests     LabTestRequest[]
  reports             MedicalReport[]
  patientAssignment   PatientAssignment?
  user                User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  prescriptions       Prescription[]
  vitalReadings       VitalReading[]
  vitals              VitalSign[]

  @@map("pregnancies")
}

model KickCount {
  id          String    @id @default(cuid())
  userId      String
  pregnancyId String
  count       Int
  duration    Int
  week        Int?
  notes       String?
  startedAt   DateTime
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  pregnancy   Pregnancy @relation(fields: [pregnancyId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("kick_counts")
}

model ContractionSession {
  id           String        @id @default(cuid())
  userId       String
  pregnancyId  String
  startedAt    DateTime      @default(now())
  endedAt      DateTime?
  createdAt    DateTime      @default(now())
  pregnancy    Pregnancy     @relation(fields: [pregnancyId], references: [id], onDelete: Cascade)
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  contractions Contraction[]

  @@map("contraction_sessions")
}

model Contraction {
  id          String                @id @default(cuid())
  userId      String
  pregnancyId String
  duration    Int
  intensity   ContractionIntensity?
  notes       String?
  createdAt   DateTime              @default(now())
  sessionId   String
  startTime   DateTime
  pregnancy   Pregnancy             @relation(fields: [pregnancyId], references: [id], onDelete: Cascade)
  session     ContractionSession    @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user        User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("contractions")
}

model MedicationReminder {
  id        String              @id @default(cuid())
  userId    String
  name      String
  dosage    String
  frequency MedicationFrequency
  timeOfDay String[]
  startDate DateTime
  endDate   DateTime?
  isActive  Boolean             @default(true)
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt
  logs      MedicationLog[]
  user      User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("medication_reminders")
}

model MedicationLog {
  id           String             @id @default(cuid())
  reminderId   String
  taken        Boolean            @default(false)
  takenAt      DateTime?
  skipped      Boolean            @default(false)
  notes        String?
  scheduledFor DateTime
  createdAt    DateTime           @default(now())
  reminder     MedicationReminder @relation(fields: [reminderId], references: [id], onDelete: Cascade)

  @@map("medication_logs")
}

model Appointment {
  id              String            @id @default(cuid())
  userId          String
  pregnancyId     String?
  title           String
  description     String?
  type            AppointmentType
  purpose         String?
  doctorId        String?
  doctorName      String?
  doctorPhone     String?
  doctorEmail     String?
  location        String?
  date            DateTime
  duration        Int               @default(30)
  status          AppointmentStatus @default(SCHEDULED)
  reminderEnabled Boolean           @default(true)
  reminderHours   Int               @default(24)
  reminderSent    Boolean           @default(false)
  reminderTime    DateTime?
  notes           String?
  doctorAdvice    String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  doctor          User?             @relation("DoctorAppointments", fields: [doctorId], references: [id])
  pregnancy       Pregnancy?        @relation(fields: [pregnancyId], references: [id])
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("appointments")
}

model VitalSign {
  id          String     @id @default(cuid())
  userId      String
  pregnancyId String?
  type        VitalType
  value       Float
  unit        String
  week        Int?
  notes       String?
  recordedAt  DateTime   @default(now())
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  pregnancy   Pregnancy? @relation(fields: [pregnancyId], references: [id])
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("vital_signs")
}

model VitalReading {
  id            String       @id @default(cuid())
  userId        String
  pregnancyId   String?
  systolic      Int?
  diastolic     Int?
  heartRate     Int?
  weight        Float?
  temperature   Float?
  glucose       Float?
  spo2          Int?
  fetalMovement Int?
  week          Int?
  notes         String?
  hasAlerts     Boolean      @default(false)
  recordedAt    DateTime     @default(now())
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  alerts        VitalAlert[]
  pregnancy     Pregnancy?   @relation(fields: [pregnancyId], references: [id])
  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("vital_readings")
}

model VitalAlert {
  id             String        @id @default(cuid())
  readingId      String
  type           AlertType
  severity       AlertSeverity
  message        String
  acknowledged   Boolean       @default(false)
  acknowledgedAt DateTime?
  createdAt      DateTime      @default(now())
  reading        VitalReading  @relation(fields: [readingId], references: [id], onDelete: Cascade)

  @@map("vital_alerts")
}

model MedicalReport {
  id          String          @id @default(cuid())
  userId      String
  pregnancyId String?
  title       String
  type        ReportType
  category    ReportCategory?
  description String?
  fileUrl     String
  fileName    String
  fileSize    Int
  mimeType    String
  reportDate  DateTime?
  expiryDate  DateTime?
  isExpired   Boolean         @default(false)
  doctorName  String?
  doctorNotes String?
  clinicName  String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  pregnancy   Pregnancy?      @relation(fields: [pregnancyId], references: [id])
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("medical_reports")
}

model Notification {
  id        String               @id @default(cuid())
  userId    String
  title     String
  message   String
  type      NotificationType
  priority  NotificationPriority @default(NORMAL)
  link      String?
  action    String?
  read      Boolean              @default(false)
  readAt    DateTime?
  createdAt DateTime             @default(now())
  user      User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model NotificationPreference {
  id                        String   @id @default(cuid())
  userId                    String   @unique
  emailEnabled              Boolean  @default(true)
  emailAppointmentReminders Boolean  @default(true)
  emailVitalReminders       Boolean  @default(true)
  emailReportAlerts         Boolean  @default(true)
  pushEnabled               Boolean  @default(true)
  pushAppointmentReminders  Boolean  @default(true)
  pushVitalReminders        Boolean  @default(true)
  pushReportAlerts          Boolean  @default(true)
  appointmentReminderHours  Int      @default(24)
  vitalReminderDays         Int      @default(7)
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt
  user                      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notification_preferences")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model Department {
  id           String   @id @default(cuid())
  name         String   @unique
  description  String?
  location     String?
  headDoctor   String?
  contactPhone String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  doctors      User[]

  @@map("departments")
}

model SystemLog {
  id         String   @id @default(cuid())
  action     String
  details    String?
  adminId    String
  targetId   String?
  targetType String?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  admin      User     @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@map("system_logs")
}

model MedicalNote {
  id        String   @id @default(cuid())
  patientId String
  doctorId  String
  content   String
  category  String   @default("GENERAL")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  doctor    User     @relation("DoctorNotes", fields: [doctorId], references: [id], onDelete: Cascade)
  patient   User     @relation("PatientNotes", fields: [patientId], references: [id], onDelete: Cascade)

  @@map("medical_notes")
}

model Prescription {
  id           String             @id @default(cuid())
  patientId    String
  doctorId     String
  pregnancyId  String?
  medication   String
  dosage       String
  frequency    String
  duration     String
  instructions String?
  status       PrescriptionStatus @default(ACTIVE)
  startDate    DateTime           @default(now())
  endDate      DateTime?
  reason       String?
  sideEffects  String?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  doctor       User               @relation("DoctorPrescriptions", fields: [doctorId], references: [id], onDelete: Cascade)
  patient      User               @relation("PatientPrescriptions", fields: [patientId], references: [id], onDelete: Cascade)
  pregnancy    Pregnancy?         @relation(fields: [pregnancyId], references: [id])

  @@map("prescriptions")
}

model LabTestRequest {
  id            String        @id @default(cuid())
  patientId     String
  doctorId      String
  pregnancyId   String?
  testType      LabTestType
  testName      String
  description   String?
  urgency       TestUrgency   @default(ROUTINE)
  preferredDate DateTime?
  status        LabTestStatus @default(PENDING)
  requestedAt   DateTime      @default(now())
  completedAt   DateTime?
  resultUrl     String?
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  doctor        User          @relation("DoctorLabTests", fields: [doctorId], references: [id], onDelete: Cascade)
  patient       User          @relation("PatientLabTests", fields: [patientId], references: [id], onDelete: Cascade)
  pregnancy     Pregnancy?    @relation(fields: [pregnancyId], references: [id])

  @@map("lab_test_requests")
}

model DoctorSchedule {
  id          String    @id @default(cuid())
  doctorId    String
  dayOfWeek   Int
  startTime   String
  endTime     String
  isAvailable Boolean   @default(true)
  maxPatients Int       @default(20)
  specialDate DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  doctor      User      @relation("DoctorSchedules", fields: [doctorId], references: [id], onDelete: Cascade)

  @@map("doctor_schedules")
}

model PatientAssignment {
  id                 String           @id @default(cuid())
  patientId          String
  doctorId           String
  pregnancyId        String?          @unique
  assignedAt         DateTime         @default(now())
  isPrimary          Boolean          @default(true)
  status             AssignmentStatus @default(ACTIVE)
  notes              String?
  consentStatus      ConsentStatus    @default(GRANTED)
  consentRequestedAt DateTime?        @default(now())
  consentGrantedAt   DateTime?        @default(now())
  consentRevokedAt   DateTime?
  accessLevel        AccessLevel      @default(FULL)
  revokeReason       String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  doctor             User             @relation("DoctorAssignments", fields: [doctorId], references: [id], onDelete: Cascade)
  patient            User             @relation("PatientAssignments", fields: [patientId], references: [id], onDelete: Cascade)
  pregnancy          Pregnancy?       @relation(fields: [pregnancyId], references: [id])

  @@map("patient_assignments")
}

model Conversation {
  id            String    @id @default(cuid())
  patientId     String
  doctorId      String
  lastMessageAt DateTime  @default(now())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  doctor        User      @relation("DoctorConversations", fields: [doctorId], references: [id])
  patient       User      @relation("PatientConversations", fields: [patientId], references: [id])
  messages      Message[]

  @@unique([patientId, doctorId])
  @@map("conversations")
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  senderId       String
  content        String
  read           Boolean      @default(false)
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User         @relation("SentMessages", fields: [senderId], references: [id])

  @@map("messages")
}

model AIChatSession {
  id        String      @id @default(cuid())
  userId    String
  isActive  Boolean     @default(true)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages  AIMessage[]

  @@map("ai_chat_sessions")
}

model AIMessage {
  id        String        @id @default(cuid())
  sessionId String
  role      AIRole
  content   String
  createdAt DateTime      @default(now())
  session   AIChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@map("ai_messages")
}

enum UserRole {
  PATIENT
  DOCTOR
  ADMIN
}

enum PregnancyStatus {
  ACTIVE
  COMPLETED
  TERMINATED
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
}

enum ContractionIntensity {
  MILD
  MODERATE
  STRONG
}

enum MedicationFrequency {
  DAILY
  TWICE_DAILY
  THREE_TIMES_DAILY
  WEEKLY
  AS_NEEDED
}

enum AppointmentType {
  ROUTINE_CHECKUP
  ULTRASOUND
  LAB_TEST
  CONSULTATION
  EMERGENCY
  OTHER
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum VitalType {
  WEIGHT
  BLOOD_PRESSURE_SYSTOLIC
  BLOOD_PRESSURE_DIASTOLIC
  HEART_RATE
  TEMPERATURE
  BLOOD_SUGAR
  SPO2
  GLUCOSE
  FETAL_MOVEMENT
  OTHER
}

enum AlertType {
  HIGH_BLOOD_PRESSURE
  LOW_BLOOD_PRESSURE
  HIGH_HEART_RATE
  LOW_HEART_RATE
  RAPID_WEIGHT_GAIN
  HIGH_GLUCOSE
  LOW_SPO2
  REDUCED_FETAL_MOVEMENT
}

enum AlertSeverity {
  INFO
  WARNING
  CRITICAL
}

enum ReportType {
  ULTRASOUND
  LAB_RESULT
  BLOOD_TEST
  URINE_TEST
  PRESCRIPTION
  DOCTOR_NOTES
  OTHER
}

enum ReportCategory {
  DATING_SCAN
  ANATOMY_SCAN
  GROWTH_SCAN
  DOPPLER_SCAN
  COMPLETE_BLOOD_COUNT
  GLUCOSE_TOLERANCE
  THYROID_FUNCTION
  IRON_STUDIES
  GENETIC_SCREENING
  ROUTINE_URINALYSIS
  URINE_CULTURE
  PROTEIN_TEST
  PRESCRIPTION
  DOCTOR_NOTES
  VACCINATION_RECORD
  OTHER
}

enum NotificationType {
  APPOINTMENT_REMINDER
  APPOINTMENT_CREATED
  APPOINTMENT_UPDATED
  VITAL_REMINDER
  REPORT_UPLOADED
  SYSTEM_ALERT
  GENERAL
  MESSAGE_RECEIVED
  HEALTH_ALERT
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum PrescriptionStatus {
  ACTIVE
  COMPLETED
  DISCONTINUED
  EXPIRED
}

enum LabTestType {
  BLOOD_TEST
  URINE_TEST
  ULTRASOUND
  GLUCOSE_TOLERANCE
  GENETIC_SCREENING
  THYROID_FUNCTION
  IRON_STUDIES
  OTHER
}

enum TestUrgency {
  ROUTINE
  URGENT
  EMERGENCY
}

enum LabTestStatus {
  PENDING
  SCHEDULED
  COMPLETED
  CANCELLED
}

enum AssignmentStatus {
  ACTIVE
  INACTIVE
  TRANSFERRED
}

enum ConsentStatus {
  PENDING
  GRANTED
  REVOKED
  EXPIRED
}

enum AccessLevel {
  FULL
  LIMITED
}

enum AIRole {
  USER
  ASSISTANT
  SYSTEM
}
